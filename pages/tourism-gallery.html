<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tourism Gallery - IBADAT</title>
    <link rel="icon" href="../images/favicon.png" type="image/png">
    <link rel="stylesheet" href="../css/style.css?v=17">
    <link rel="preload" href="../tourism_imgs/p1.jpg" as="image">
    <link rel="preload" href="../tourism_imgs/p2.jpg" as="image">
    <link rel="preload" href="../tourism_imgs/p3.jpg" as="image">
    <link rel="preload" href="../tourism_imgs/p4.jpg" as="image">
    <link rel="preload" href="../tourism_imgs/p5.jpg" as="image">
    <link rel="preload" href="../tourism_imgs/p6.jpg" as="image">
</head>
<body>
    <header>
        <nav>
            <div class="logo">
                <img src="../images/logo.webp" alt="IBADAT Logo" class="logo-img">
                <div>
                    <h1>IBADAT</h1>
                    <p>Umrah & Zayarat Group</p>
                </div>
            </div>

            <div class="menu-toggle" onclick="toggleMenu()">
                <span></span>
                <span></span>
                <span></span>
            </div>
            <ul id="navMenu">
                <li><a href="../index.html">Home</a></li>
                <li><a href="../index.html#about">About Us</a></li>
                <li><a href="../index.html#services">Services</a></li>
                <li><a href="umrah-packages.html" class="blink">Packages</a></li>
                <li><a href="tourism-gallery.html" class="active">Tourism Gallery</a></li>
                <li><a href="../index.html#contact">Contact</a></li>
            </ul>
        </nav>
    </header>

    <main class="tourism-gallery-page">
        <section class="gallery-hero">
            <div class="container">
                <h2>Tourism Gallery</h2>
                <p>Explore beautiful destinations and moments captured by our travelers</p>
            </div>
        </section>

        <section class="gallery-section container">
            <div class="gallery-grid" id="gallery">
                <!-- Column masonry: first six images eager for faster initial paint; others lazy with placeholder+fallback -->
                <a class="gallery-item" href="../tourism_imgs/p1.jpg"><img src="../tourism_imgs/p1.jpg" alt="Tourism 1" loading="eager" decoding="async" fetchpriority="high" onerror="this.onerror=null;this.src='../images/logo.webp';this.classList.add('is-loaded');"></a>
                <a class="gallery-item" href="../tourism_imgs/p2.jpg"><img src="../tourism_imgs/p2.jpg" alt="Tourism 2" loading="eager" decoding="async" fetchpriority="high" onerror="this.onerror=null;this.src='../images/logo.webp';this.classList.add('is-loaded');"></a>
                <a class="gallery-item" href="../tourism_imgs/p3.jpg"><img src="../tourism_imgs/p3.jpg" alt="Tourism 3" loading="eager" decoding="async" fetchpriority="high" onerror="this.onerror=null;this.src='../images/logo.webp';this.classList.add('is-loaded');"></a>
                <a class="gallery-item" href="../tourism_imgs/p4.jpg"><img src="../tourism_imgs/p4.jpg" alt="Tourism 4" loading="eager" decoding="async" fetchpriority="high" onerror="this.onerror=null;this.src='../images/logo.webp';this.classList.add('is-loaded');"></a>
                <a class="gallery-item" href="../tourism_imgs/p5.jpg"><img src="../tourism_imgs/p5.jpg" alt="Tourism 5" loading="eager" decoding="async" fetchpriority="high" onerror="this.onerror=null;this.src='../images/logo.webp';this.classList.add('is-loaded');"></a>
                <a class="gallery-item" href="../tourism_imgs/p6.jpg"><img src="../tourism_imgs/p6.jpg" alt="Tourism 6" loading="eager" decoding="async" fetchpriority="high" onerror="this.onerror=null;this.src='../images/logo.webp';this.classList.add('is-loaded');"></a>
                <a class="gallery-item" href="../tourism_imgs/p7.jpg"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==" data-src="../tourism_imgs/p7.jpg" alt="Tourism 7" loading="lazy" decoding="async" class="lazy"></a>
                <a class="gallery-item" href="../tourism_imgs/p8.jpg"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==" data-src="../tourism_imgs/p8.jpg" alt="Tourism 8" loading="lazy" decoding="async" class="lazy"></a>
                <a class="gallery-item" href="../tourism_imgs/p9.jpg"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==" data-src="../tourism_imgs/p9.jpg" alt="Tourism 9" loading="lazy" decoding="async" class="lazy"></a>
                <a class="gallery-item" href="../tourism_imgs/p10.jpg"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==" data-src="../tourism_imgs/p10.jpg" alt="Tourism 10" loading="lazy" decoding="async" class="lazy"></a>
                <a class="gallery-item" href="../tourism_imgs/p11.jpg"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==" data-src="../tourism_imgs/p11.jpg" alt="Tourism 11" loading="lazy" decoding="async" class="lazy"></a>
                <a class="gallery-item" href="../tourism_imgs/p12.jpg"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==" data-src="../tourism_imgs/p12.jpg" alt="Tourism 12" loading="lazy" decoding="async" class="lazy"></a>
                <a class="gallery-item" href="../tourism_imgs/p13.jpg"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==" data-src="../tourism_imgs/p13.jpg" alt="Tourism 13" loading="lazy" decoding="async" class="lazy"></a>
                <a class="gallery-item" href="../tourism_imgs/p14.jpg"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==" data-src="../tourism_imgs/p14.jpg" alt="Tourism 14" loading="lazy" decoding="async" class="lazy"></a>
                <a class="gallery-item" href="../tourism_imgs/p15.jpg"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==" data-src="../tourism_imgs/p15.jpg" alt="Tourism 15" loading="lazy" decoding="async" class="lazy"></a>
                <a class="gallery-item" href="../tourism_imgs/p16.jpg"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==" data-src="../tourism_imgs/p16.jpg" alt="Tourism 16" loading="lazy" decoding="async" class="lazy"></a>
                <a class="gallery-item" href="../tourism_imgs/p17.jpg"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==" data-src="../tourism_imgs/p17.jpg" alt="Tourism 17" loading="lazy" decoding="async" class="lazy"></a>
            </div>
        </section>

        <!-- Lightbox modal -->
        <div id="lightbox" class="lightbox" style="display:none;">
            <button class="lightbox-close" aria-label="Close">Ã—</button>
            <button class="lightbox-prev" aria-label="Previous">&#10094;</button>
            <img class="lightbox-img" src="" alt="">
            <button class="lightbox-next" aria-label="Next">&#10095;</button>
        </div>
    </main>

    <script>
    (function(){
        const container = document.querySelector('.gallery-grid');
        const lightbox = document.getElementById('lightbox');
        const lightboxImg = lightbox.querySelector('.lightbox-img');
        const closeBtn = lightbox.querySelector('.lightbox-close');
        const prevBtn = lightbox.querySelector('.lightbox-prev');
        const nextBtn = lightbox.querySelector('.lightbox-next');
        let io = null, resizeTimer = null, currentIndex = -1;

        function loadImageData(img){
            return new Promise(resolve => {
                const src = img.dataset.src || img.src;
                const tmp = new Image();
                tmp.src = src;
                tmp.onload = () => resolve({ img, w: tmp.naturalWidth, h: tmp.naturalHeight, aspect: tmp.naturalWidth / Math.max(1, tmp.naturalHeight), src });
                tmp.onerror = () => resolve({ img, w: 800, h: 600, aspect: 1.33, src });
            });
        }

        async function buildMosaic(){
            if(!container) return;
            const items = Array.from(container.querySelectorAll('.gallery-item'));
            const infos = [];
            for(const it of items){
                const img = it.querySelector('img');
                infos.push(await loadImageData(img));
                // reset any previous sizing
                it.style.gridColumnEnd = '';
                it.style.gridRowEnd = '';
            }

            // compute layout parameters for consistent rectangles (4:3)
            const style = getComputedStyle(container);
            const gapPx = parseInt(style.getPropertyValue('gap')) || 6;
            const rowUnit = parseInt(style.getPropertyValue('grid-auto-rows')) || 6;
            const minCol = 140 + gapPx; // approximate min tile width + gap
            const columns = Math.max(1, Math.floor((container.clientWidth + gapPx) / minCol));
            const columnWidth = Math.floor((container.clientWidth - (columns - 1) * gapPx) / columns);
            const aspectHeightFactor = 3 / 4; // height = width * (3/4) for 4:3 tiles

            infos.forEach((info, idx) => {
                const it = items[idx];
                let colSpan = 1;
                // explicit override via data-size attribute:
                const explicit = (it.dataset.size || '').toLowerCase().trim();
                if(explicit === 'large') colSpan = 2;
                else if(explicit === 'small') colSpan = 1;
                else {
                    // deterministic defaults for rhythm
                    if (idx % 7 === 3) colSpan = 2;
                    if (idx % 5 === 0 && idx % 7 !== 3) colSpan = 2;
                }

                // desired height based on column width and aspect ratio (4:3)
                const desiredHeight = Math.round(columnWidth * colSpan * aspectHeightFactor);
                const rowSpan = Math.max(1, Math.round(desiredHeight / rowUnit));

                it.style.gridColumnEnd = `span ${colSpan}`;
                it.style.gridRowEnd = `span ${rowSpan}`;

                // caption logic: use explicit data-caption if provided, otherwise use alt only when it's not a generic "Tourism N"
                const alt = (info.img.alt || '').trim();
                const captionText = info.img.dataset.caption ? info.img.dataset.caption.trim() : (alt && !/tourism\s*\d+$/i.test(alt) ? alt : '');
                if(captionText){
                    if(!it.querySelector('.caption')){
                        const cap = document.createElement('span'); cap.className = 'caption'; cap.textContent = captionText;
                        it.appendChild(cap);
                    } else {
                        it.querySelector('.caption').textContent = captionText;
                    }
                }
            });

            initLazyObserver();
            markEagerLoaded();
        }

        function initLazyObserver(){
            const lazyImgs = Array.from(document.querySelectorAll('.gallery-item img.lazy'));
            if(io){ lazyImgs.forEach(img => io.observe(img)); return; }
            if('IntersectionObserver' in window){
                io = new IntersectionObserver((entries, obs) => {
                    entries.forEach(entry => {
                        if(entry.isIntersecting){
                            const img = entry.target;
                            if(img.dataset.src) img.src = img.dataset.src;
                            img.onload = () => img.classList.add('is-loaded');
                            img.onerror = () => { img.src = '../images/logo.webp'; img.classList.add('is-loaded'); };
                            obs.unobserve(img);
                        }
                    });
                }, { rootMargin: '1000px' });
                lazyImgs.forEach(img => io.observe(img));
            } else {
                lazyImgs.forEach(img => { if(img.dataset.src) img.src = img.dataset.src; img.onload = () => img.classList.add('is-loaded'); img.onerror = () => { img.src = '../images/logo.webp'; img.classList.add('is-loaded'); }; });
            }
        }

        function markEagerLoaded(){
            document.querySelectorAll('.gallery-item img[loading="eager"]').forEach(img => {
                img.onerror = () => { img.src = '../images/logo.webp'; img.classList.add('is-loaded'); };
                if(img.complete) img.classList.add('is-loaded'); else img.onload = () => img.classList.add('is-loaded');
            });
        }

        function showLightbox(index){
            const items = Array.from(document.querySelectorAll('.gallery-item'));
            currentIndex = (index + items.length) % items.length;
            const href = items[currentIndex].href;
            lightboxImg.src = href;
            lightbox.style.display = 'flex';
            closeBtn.focus();
            const next = (currentIndex + 1) % items.length;
            const l = document.createElement('link'); l.rel = 'preload'; l.as = 'image'; l.href = items[next].href; document.head.appendChild(l);
        }
        function hideLightbox(){ lightbox.style.display = 'none'; lightboxImg.src = ''; currentIndex = -1; }
        function showNext(){ showLightbox(currentIndex + 1); }
        function showPrev(){ showLightbox(currentIndex - 1); }

        document.addEventListener('click', function(e){
            const link = e.target.closest('.gallery-item');
            if(link){ e.preventDefault(); const items = Array.from(document.querySelectorAll('.gallery-item')); showLightbox(items.indexOf(link)); return; }
            if(e.target === lightbox || e.target === closeBtn) hideLightbox();
            if(e.target === nextBtn) showNext();
            if(e.target === prevBtn) showPrev();
        });

        document.addEventListener('keydown', function(e){
            if(lightbox.style.display !== 'flex') return;
            if(e.key === 'Escape') hideLightbox();
            if(e.key === 'ArrowRight') showNext();
            if(e.key === 'ArrowLeft') showPrev();
        });

        window.addEventListener('resize', () => { clearTimeout(resizeTimer); resizeTimer = setTimeout(buildMosaic, 180); });

        // Initial build
        buildMosaic();

    })();
    </script>

</body>
</html>